<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #fff;
      color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      max-width: 400px;
      width: 100%;
      padding: 2rem 1rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    h2 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      margin: 0;
    }

    #spinBtn {
      font-size: 1.2rem;
      padding: 1rem;
      border: none;
      border-radius: 10px;
      background: linear-gradient(to right, #ffd700, #ffa500);
      color: #111;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #spinBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #result {
      font-size: 1.2rem;
      line-height: 1.6;
      word-break: break-word;
    }

    code {
      background: #eee;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>üé° –ì–æ—Ç–æ–≤ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ?</h2>
    <button id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å</button>
    <div id="result"></div>
  </div>

  <script>
    Telegram.WebApp.ready();

    document.getElementById("spinBtn").onclick = async () => {
      const userId = Telegram.WebApp.initDataUnsafe.user?.id;
      const initData = Telegram.WebApp.initData;
      const res = await fetch("/spin", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({user_id: userId, init_data: initData})
      });

      const data = await res.json();
      const result = document.getElementById("result");

      if (res.ok && data.can_spin === false) {
        result.innerHTML = `
          üîÑ –í—ã —É–∂–µ –∫—Ä—É—Ç–∏–ª–∏ –∫–æ–ª–µ—Å–æ!<br>
          üéØ –°–∫–∏–¥–∫–∞: <b>${data.prize}</b><br>
          üéÅ –ü—Ä–æ–º–æ–∫–æ–¥: <code>${data.promo_code}</code><br>
          ‚è≥ –°–ª–µ–¥—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑: <b>${data.retry_after}</b>
        `;
      } else if (res.ok) {
        result.innerHTML = `
          üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!<br>
          üéØ –°–∫–∏–¥–∫–∞: <b>${data.prize}</b><br>
          üéÅ –ü—Ä–æ–º–æ–∫–æ–¥: <code>${data.promo_code}</code>
        `;
      }
      else if (res.status === 403) {
        result.innerHTML = `
          <a href="https://t.me/asdfzxcvasf">üëâ –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª, —á—Ç–æ–±—ã –∫—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ</a>
        `;
      }
      else {

        result.innerHTML = `‚õî –û—à–∏–±–∫–∞: ${data.detail || "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫"}`;
      }
    };
  </script>
</body>

</html>
